<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Olympic Host Cities</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <!-- include the Mapbox GL Geocoder plugin CSS -->
    <script
        src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
        type="text/css">

    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
            padding-bottom: 10px;
        }

        .mapboxgl-popup,
        img {
            max-width: 100%;
        }

        .mapboxgl-popup-content {
            border-radius: 10px;
            color: #ffffff;
            background: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-content img {
            background-color: rgba(255, 255, 255, 1);
            border-radius: 6px;
            padding: 5px;
        }

        .mapboxgl-popup-content a {
            color: #ffffff;
            line-height: 2em;
        }

        .mapboxgl-popup-content h2,
        p {
            margin-bottom: 5px;
        }

        .mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
            border-top-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
            border-bottom-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
            border-right-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
            border-left-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
            border-bottom-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
            border-bottom-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
            border-top-color: rgba(0, 30, 84, 0.78);
        }

        .mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
            border-top-color: rgba(0, 30, 84, 0.78);
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiZ3JhZmEiLCJhIjoiY2ptYjNtZWxnMDBrdDNwbnVicGJzOWg2NyJ9.9OulyCe3kEqMAXPbx1mKUA';
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            center: [-2.200409173965454, 53.48315225855606], // starting position [lng, lat]
            zoom: 2, // starting zoom
            pitch: 0, // starting pitch
            bearing: 0, // starting bearing
            style: 'mapbox://styles/grafa/clpsmfu4900f901opa8dvh7sn',
            hash:true
        });
        // add the geocoder to the map
        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            // types: 'country',
            placeholder: 'Search for a country',
        });
        map.addControl(geocoder);

        const data = './cities.geojson'
        
        let features = [];
        let arr = [];
        fetch(data)
            .then(response => response.json())
            .then(data => {
                features = data.features;
                console.log('Count: ' + features.length);
                for (let i = 0; i < features.length; i++) {
                    // console.log(features[i].properties);
                    // push the properties of each feature to the arr array
                    // add a unique id to the preperties object
                    // features[i].properties.id = i;
                    // arr.push(features[i].properties);

                    
                };
                console.log(arr);
            });

        map.on('load', () => {
            map.setConfigProperty('basemap', 'lightPreset', 'dawn');
            map.addSource('venues', {
                type: 'geojson',
                data: data,
            });
            map.addLayer({
                id: 'venues',
                type: 'symbol',
                source: 'venues',
                // create a filter to only show the the symbols after zoom level 14
                filter: ['>', ['zoom'], 14],
                layout: {
                    'icon-image': 'Olympic_rings_without_rims',
                    'icon-allow-overlap': true,
                    'icon-size': 0.5,
                },
                paint: {
                    'icon-halo-width': 10,
                    'icon-halo-color': '#fff',
                    'icon-color': '#333',
                }
            });
            map.addLayer({
                id: 'venue_cirlces',
                type: 'circle',
                source: 'venues',
                filter: ['<', ['zoom'], 14],
                layout: {},
                paint: {
                    // write an expression to determine the radius of the circle based on the Times_Hosted property
                    'circle-radius': [
                        'interpolate',
                        ['linear'],
                        ['get', 'Times_Hosted'],
                        1,
                        5,
                        2,
                        10,
                        3,
                        20,
                        4,
                        30,
                        // 50,
                    ],
                    'circle-color': '#fe5a2b',
                    'circle-stroke-color': '#fff',
                    'circle-stroke-width': 1,
                }
            });
            map.addLayer({
                id: 'venue-labels',
                type: 'symbol',
                source: 'venues',
                layout: {
                    "text-field": ["concat", ["get", "City"], " ", ["get", "Country"], " ", ["get", "Year"]],
                    'text-variable-anchor': ['bottom', 'left', 'right', 'top'],
                    // 'text-radial-offset': 1,
                    // offset the anchor of the text to the right 20px
                    'text-offset': [0, 3],
                    'text-justify': 'auto',
                    'text-size': 16,
                    'text-transform': 'uppercase',
                    'text-font': ['Mark SC Offc Pro Black Italic', 'Arial Unicode MS Bold'],
                },
                paint: {
                    'text-color': '#333',
                    'text-halo-color': '#fff',
                    'text-halo-width': 1,
                }
            });
            map.on('click', 'venues', (e) => {
                const coordinates = e.features[0].geometry.coordinates.slice();
                const { City, Year, Country, Times_Hosted, Season } = e.features[0].properties;
                new mapboxgl.Popup()
                    .setLngLat(coordinates)
                    .setHTML(`<h3>${City}</h3>
                    <p>${Year}</p>
                    <p><strong>Host Country: </strong>${Country}</p>
                    <p><strong>Times Hosted: </strong>${Times_Hosted}</p>
                    <p><strong>Season: </strong>${Season}</p>
                    
                    `)
                    .addTo(map);
                zoomToVenue(coordinates);
            });
            const zoomToVenue = (coordinates) => {
                map.flyTo({
                    center: coordinates,
                    zoom: 16,
                    pitch: 60,
                    speed: 1.5
                });
            };
        });
    </script>
</body>

</html>